import createLoadingBar from"./helper/loading.js";import createOrbMenu from"./unit-table/orb/create-orb-selector.js";import{initializeOrbSelection}from"./unit-table/orb/orb-selection.js";import createTableOptionModal from"./unit-table/creation/create-table-modal.js";import createSearchableTable from"./unit-table/creation/create-unit-table.js";import{attachTableOptionsAndFilters,initializeTableModal}from"./unit-table/filter-units.js";import makeSearchable,{createSearchDropdown,initializeDataset}from"./helper/make-searchable.js";import{checkPort,REQUEST_TYPES}from"./communication/iframe-link.js";import{RARITY}from"./data/unit-data.js";import createSearchModal,{openSearchModal}from"./unit-table/creation/create-search-modal.js";function loadUnitTables(){const scrollable=document.querySelector("#loading-content"),loadingBar=createLoadingBar(8,()=>{}),datalist=createSearchDropdown();document.body.appendChild(datalist),document.body.appendChild(createSearchModal()),makeSearchable(document.querySelector("#unit-search"),targettedID=>{const target=[...document.querySelectorAll(".row-id")].find(r=>r.textContent===`${targettedID}`)?.parentElement;!target||target.classList.contains("hidden")||target.classList.contains("filter-hidden")||(target.parentElement?.classList.contains("hidden")&&target.parentElement.parentElement.querySelector(".searchable-table-title").click(),scrollable.scrollTo({left:0,top:scrollable.scrollTop+target.getBoundingClientRect().top-60,behavior:"smooth"}))}),REQUEST_TYPES.GET_NAMES().then(names=>initializeDataset(datalist,names)).then(_=>loadingBar.increment());const tableAppending=[REQUEST_TYPES.GET_RARITY_DATA(RARITY.NORMAL).then(units=>{const table=createSearchableTable("Normal Cats",units,REQUEST_TYPES.UPDATE_ID,loadingBar);return table.id="normal-table",table.classList.add("normal-color"),loadingBar.increment(),table}),REQUEST_TYPES.GET_RARITY_DATA(RARITY.SPECIAL).then(units=>{const table=createSearchableTable("Special Cats",units,REQUEST_TYPES.UPDATE_ID,loadingBar);return table.id="special-table",table.classList.add("special-color"),loadingBar.increment(),table}),REQUEST_TYPES.GET_RARITY_DATA(RARITY.RARE).then(units=>{const table=createSearchableTable("Rare Cats",units,REQUEST_TYPES.UPDATE_ID,loadingBar);return table.id="rare-table",table.classList.add("rare-color"),loadingBar.increment(),table}),REQUEST_TYPES.GET_RARITY_DATA(RARITY.SUPER_RARE).then(units=>{const table=createSearchableTable("Super Rare Cats",units,REQUEST_TYPES.UPDATE_ID,loadingBar);return table.id="super-table",table.classList.add("super-rare-color"),loadingBar.increment(),table}),REQUEST_TYPES.GET_RARITY_DATA(RARITY.UBER_RARE).then(units=>{const table=createSearchableTable("Uber Rare Cats",units,REQUEST_TYPES.UPDATE_ID,loadingBar);return table.id="uber-table",table.classList.add("uber-rare-color"),loadingBar.increment(),table}),REQUEST_TYPES.GET_RARITY_DATA(RARITY.LEGEND_RARE).then(units=>{const table=createSearchableTable("Legend Rare Cats",units,REQUEST_TYPES.UPDATE_ID,loadingBar,!0);return table.id="legend-table",table.classList.add("legend-rare-color"),loadingBar.increment(),table})];Promise.all(tableAppending).then(tables=>{document.querySelector("#loading-content")?.append(...tables),tables.forEach(t=>attachTableOptionsAndFilters(t)),initializeQuickNav(),loadingBar.increment()})}function initializeQuickNav(){const nav=document.querySelector("#quick-nav"),scrollable=document.querySelector("#loading-content");nav.querySelector("#quick-nav-access").onclick=()=>nav.classList.toggle("raised"),document.querySelector("#unit-advanced-search").onclick=()=>openSearchModal(u=>{const target=[...document.querySelectorAll(".row-id")].find(r=>r.textContent===`${u.id}`)?.parentElement;!target||target.classList.contains("hidden")||target.classList.contains("filter-hidden")||(target.parentElement?.classList.contains("hidden")&&target.parentElement.parentElement.querySelector(".searchable-table-title").click(),scrollable.scrollTo({left:0,top:scrollable.scrollTop+target.getBoundingClientRect().top-60,behavior:"smooth"}))});const normalJump=nav.querySelector("#normal-jump"),normalTable=document.querySelector("#normal-table");normalJump.onclick=()=>scrollable.scrollTo({left:0,top:scrollable.scrollTop+normalTable.getBoundingClientRect().top,behavior:"smooth"});const specialJump=nav.querySelector("#special-jump"),specialTable=document.querySelector("#special-table");specialJump.onclick=()=>scrollable.scrollTo({left:0,top:scrollable.scrollTop+specialTable.getBoundingClientRect().top,behavior:"smooth"});const rareJump=nav.querySelector("#rare-jump"),rareTable=document.querySelector("#rare-table");rareJump.onclick=()=>scrollable.scrollTo({left:0,top:scrollable.scrollTop+rareTable.getBoundingClientRect().top,behavior:"smooth"});const superJump=nav.querySelector("#super-jump"),superTable=document.querySelector("#super-table");superJump.onclick=()=>scrollable.scrollTo({left:0,top:scrollable.scrollTop+superTable.getBoundingClientRect().top,behavior:"smooth"});const uberJump=nav.querySelector("#uber-jump"),uberTable=document.querySelector("#uber-table");uberJump.onclick=()=>scrollable.scrollTo({left:0,top:scrollable.scrollTop+uberTable.getBoundingClientRect().top,behavior:"smooth"});const legendJump=nav.querySelector("#legend-jump"),legendTable=document.querySelector("#legend-table");legendJump.onclick=()=>scrollable.scrollTo({left:0,top:scrollable.scrollTop+legendTable.getBoundingClientRect().top,behavior:"smooth"})}window.addEventListener("DOMContentLoaded",()=>{document.body.appendChild(createOrbMenu()),initializeOrbSelection(),document.body.appendChild(createTableOptionModal()),initializeTableModal(),window.addEventListener("portLoaded",loadUnitTables),checkPort()&&window.dispatchEvent(new CustomEvent("portLoaded"))});