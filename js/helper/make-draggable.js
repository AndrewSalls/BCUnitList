const MIN_DRAG_DISTANCE=5;let mouseDownPos=null,target=null,targetCallback=null,hoverTarget=null,targetClone=null;window.addEventListener("mousemove",ev=>{if(!window.document.body.classList.contains("disabled-editing-mode")){if(mouseDownPos&&Math.sqrt(Math.pow(ev.clientX-mouseDownPos.x,2)+Math.pow(ev.clientY-mouseDownPos.y,2))>5&&!targetClone){target.style.pointerEvents="none",targetClone=document.createElement("div"),targetClone.classList.add("chip"),targetClone.style.pointerEvents="none",targetClone.style.position="absolute",targetClone.style.opacity="0.7";const targetCloneIMG=document.createElement("img");targetCloneIMG.classList.add("unit-icon"),targetCloneIMG.src=target.querySelector("img").src,targetCloneIMG.style.pointerEvents="none",targetClone.appendChild(targetCloneIMG),window.document.body.appendChild(targetClone)}targetClone&&(targetClone.style.left=ev.pageX-mouseDownPos.localX+"px",targetClone.style.top=ev.pageY-mouseDownPos.localY+"px")}}),window.addEventListener("mouseup",()=>{if(target&&hoverTarget){const span=document.createElement("span");target.parentElement.insertBefore(span,target),target.parentElement.insertBefore(target,hoverTarget.nextSibling),target.parentElement.insertBefore(hoverTarget,span),span.remove(),sortIcons(target.parentElement),targetCallback&&targetCallback()}mouseDownPos=null,target&&(target.style.pointerEvents=""),target=null,hoverTarget&&hoverTarget.classList.remove("dragover"),targetCallback=null,hoverTarget=null,targetClone&&targetClone.remove(),targetClone=null});export default function makeDraggable(loadoutIconList,loadoutChangeCallback=null){loadoutIconList.querySelectorAll(".chip").forEach(unit=>{unit.addEventListener("mousedown",ev=>{if(window.document.body.classList.contains("disabled-editing-mode")||!unit.classList.contains("set-unit"))return;const bBox=unit.getBoundingClientRect();mouseDownPos={localX:ev.clientX-bBox.left,localY:ev.clientY-bBox.top,x:ev.pageX,y:ev.pageY},target=unit,targetCallback=loadoutChangeCallback}),unit.addEventListener("mouseenter",()=>{window.document.body.classList.contains("disabled-editing-mode")||target&&target!==unit&&target.parentElement===unit.parentElement&&(hoverTarget=unit,unit.classList.add("dragover"))}),unit.addEventListener("mouseleave",()=>{hoverTarget=null,unit.classList.remove("dragover")})})}export function sortIcons(listWrapper){listWrapper.querySelectorAll(".chip").forEach(unit=>{unit.classList.contains("set-unit")||listWrapper.appendChild(unit)})}