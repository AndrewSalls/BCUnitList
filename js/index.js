import initializeData,{registerFrame}from"./communication/link-units.js";import SETTINGS from"../assets/settings.js";function loadTo(src,skipHistory=!1){skipHistory||"0"!==window.localStorage.getItem("s6")||window.history.pushState(src,"",`${window.top?.location.pathname}?page=${src}`);document.querySelector("#content-page").outerHTML=`<iframe src="./${src}.html" id="content-page" title="Page Content"></iframe>`;const newFrame=document.querySelector("#content-page");registerFrame(newFrame)}function displayMessage(message,isError){const saveText=document.querySelector("#save-change-text");saveText.classList.add("hidden"),saveText.textContent=message,saveText.classList.toggle("error-msg",isError),saveText.clientHeight,saveText.classList.remove("hidden")}document.addEventListener("DOMContentLoaded",()=>{initializeData(document.querySelector("#content-page"),displayMessage).then(()=>{const nav=document.querySelector("#nav-bar");nav.querySelector("#version-number").textContent=SETTINGS.gameVersion,nav.querySelector("#version-info").classList.remove("hidden");const setPage=target=>{nav.querySelectorAll("button").forEach(b=>b.classList.remove("current")),target.classList.add("current")},home=nav.querySelector("#home-button");home.onclick=_=>{home.classList.contains("current")||(setPage(home),loadTo("home"))};const viewUnit=nav.querySelector("#view-unit-button");viewUnit.onclick=_=>{viewUnit.classList.contains("current")||(setPage(viewUnit),loadTo("unit-list"))};const specific=nav.querySelector("#view-singular-button");specific.onclick=_=>{specific.classList.contains("current")||(setPage(specific),loadTo("unit-specific"))};const category=nav.querySelector("#category-button");category.onclick=_=>{category.classList.contains("current")||(setPage(category),loadTo("unit-category"))};const viewcost=nav.querySelector("#view-costs-button");viewcost.onclick=_=>{viewcost.classList.contains("current")||(setPage(viewcost),loadTo("unit-costs"))};const catBase=nav.querySelector("#cat-base-button");catBase.onclick=_=>{catBase.classList.contains("current")||(setPage(catBase),loadTo("cat-base"))};const loadout=nav.querySelector("#loadout-button");loadout.onclick=_=>{loadout.classList.contains("current")?document.querySelector("#content-page").contentWindow?.location.href.includes("loadout-display.html")&&loadTo("loadout"):(setPage(loadout),loadTo("loadout"))};const settingsPage=nav.querySelector("#settings-button");settingsPage.onclick=_=>{settingsPage.classList.contains("current")||(setPage(settingsPage),loadTo("settings"))};const loadHistory=pageData=>{switch(pageData){case"unit-list":return viewUnit;case"unit-specific":return specific;case"unit-category":return category;case"unit-costs":return viewcost;case"cat-base":return catBase;case"loadout":return loadout;case"settings":return settingsPage;default:return home}},pageRef=new URLSearchParams(window.location.search.slice(1)).get("page");pageRef?loadHistory(pageRef).click():(setPage(home),loadTo("home",!0)),window.addEventListener("popstate",e=>{const targetPage=new URLSearchParams(e.target.location.search.slice(1)).get("page")??"home";setPage(loadHistory(targetPage)),loadTo(targetPage,!0)})})});