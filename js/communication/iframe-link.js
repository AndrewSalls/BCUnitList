import{RARITY,UNIT_DATA_TYPE}from"../data/unit-data.js";import{RESPONSE_TYPES}from"./handle-message.js";export const REQUEST_TYPES={UPDATE_ID:unit=>makeRequest(RESPONSE_TYPES.UPDATE_UNIT,unit),GET_ID_DATA:(id,ignoreFilters=!1)=>makeRequest(RESPONSE_TYPES.GET_UNIT,{target:id,dataType:UNIT_DATA_TYPE.UNIT},ignoreFilters).then(u=>u.length>0?u[0]:null),GET_MULTIPLE_DATA:(idList,ignoreFilters=!1)=>makeRequest(RESPONSE_TYPES.GET_UNIT_LIST,{target:idList,dataType:UNIT_DATA_TYPE.UNIT},ignoreFilters),GET_RARITY_DATA:(rarity,ignoreFilters=!1)=>makeRequest(RESPONSE_TYPES.GET_ALL_OF_RARITY,{target:rarity,dataType:UNIT_DATA_TYPE.UNIT},ignoreFilters),GET_FAVORITED_DATA:(ignoreFilters=!1)=>makeRequest(RESPONSE_TYPES.GET_ALL_FAVORITED,UNIT_DATA_TYPE.UNIT,ignoreFilters),GET_ALL_DATA:(ignoreFilters=!1)=>makeRequest(RESPONSE_TYPES.GET_ALL,UNIT_DATA_TYPE.UNIT,ignoreFilters),GET_ID_COST:(id,ignoreFilters=!1)=>makeRequest(RESPONSE_TYPES.GET_UNIT,{target:id,dataType:UNIT_DATA_TYPE.COST},ignoreFilters),GET_MULTIPLE_COST:(idList,ignoreFilters=!1)=>makeRequest(RESPONSE_TYPES.GET_UNIT_LIST,{target:idList,dataType:UNIT_DATA_TYPE.COST},ignoreFilters),GET_RARITY_COST:(rarity,ignoreFilters=!1)=>makeRequest(RESPONSE_TYPES.GET_ALL_OF_RARITY,{target:rarity,dataType:UNIT_DATA_TYPE.COST},ignoreFilters),GET_FAVORITED_COST:(ignoreFilters=!1)=>makeRequest(RESPONSE_TYPES.GET_ALL_FAVORITED,UNIT_DATA_TYPE.COST,ignoreFilters),GET_ALL_COST:(ignoreFilters=!1)=>makeRequest(RESPONSE_TYPES.GET_ALL,UNIT_DATA_TYPE.COST,ignoreFilters),IS_ANY_UNFILTERED:(idList,ignoreFilters=!1)=>makeRequest(RESPONSE_TYPES.IS_ANY_UNFILTERED,{target:idList,dataType:UNIT_DATA_TYPE.UNIT},ignoreFilters),GET_NAMES:(ignoreFilters=!1)=>makeRequest(RESPONSE_TYPES.GET_ALL,UNIT_DATA_TYPE.FORM_NAMES,ignoreFilters),GET_OWNED_FORM_NAMES:(ignoreFilters=!1)=>makeRequest(RESPONSE_TYPES.GET_ALL,UNIT_DATA_TYPE.OWNED_FORM_NAMES,ignoreFilters),GET_CATEGORIES:(ignoreFilters=!1)=>makeRequest(RESPONSE_TYPES.GET_CATEGORIES,null,ignoreFilters),GET_CATEGORIES_ORDER:(ignoreFilters=!1)=>makeRequest(RESPONSE_TYPES.GET_CATEGORIES_ORDER,null,ignoreFilters),MODIFY_CUSTOM_CATEGORY:(categoryName,categoryValues)=>makeRequest(RESPONSE_TYPES.MODIFY_CUSTOM_CATEGORY,{category:categoryName,newUnits:categoryValues}),REMOVE_CUSTOM_CATEGORY:categoryName=>makeRequest(RESPONSE_TYPES.DELETE_CUSTOM_CATEGORY,categoryName),GET_ABILITY:index=>makeRequest(RESPONSE_TYPES.GET_ABILITY,index),GET_ALL_ABILITY:()=>makeRequest(RESPONSE_TYPES.GET_ALL_ABILITY,null),GET_CGS:()=>makeRequest(RESPONSE_TYPES.GET_CGS,null),GET_UPGRADE_COST:()=>makeRequest(RESPONSE_TYPES.GET_UPGRADE_COSTS,null),UPDATE_ABILITY:(index,level,plusLevel)=>makeRequest(RESPONSE_TYPES.UPDATE_ABILITY,{id:index,level:level,plus:plusLevel}),UPDATE_CGS:owned=>makeRequest(RESPONSE_TYPES.UPDATE_CGS,owned),GET_ALL_LOADOUT:()=>makeRequest(RESPONSE_TYPES.GET_LOADOUTS,null),MODIFY_LOADOUT:(index,loadout)=>makeRequest(RESPONSE_TYPES.MODIFY_LOADOUT,{position:index,loadout:loadout}),DELETE_LOADOUT:index=>makeRequest(RESPONSE_TYPES.DELETE_LOADOUT,index),SEND_ALERT:(message,isError)=>makeRequest(RESPONSE_TYPES.DISPLAY_MESSAGE,{message:message,isError:isError}),DELETE_USER_DATA:(message,isError)=>makeRequest(RESPONSE_TYPES.DELETE_USER_DATA,{message:message,isError:isError})};const MAX_POST_ID=8192;let curPostID=0,port=null;const callbacks=new Map;window.onmessage=ev=>{ev.ports&&ev.ports.length&&(port=ev.ports[0],port.onmessage=res=>{const response=res.data;callbacks.get(response.m_id)(response.data),callbacks.delete(response.m_id)},window.dispatchEvent(new CustomEvent("portLoaded")))};export function checkPort(){return null!==port}function makeRequest(requestType,requestContents,ignoreFilters=!1){const messageID=curPostID++,output=new Promise((res,_)=>{callbacks.set(messageID,res)});return port?.postMessage({context:requestType,content:requestContents,m_id:messageID,ignore_filters:ignoreFilters}),curPostID%=MAX_POST_ID,output}